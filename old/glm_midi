#! /bin/csh


#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-
#                                                                        
#    3dDeconvolve Regression
#
#    Auto-generated by ScriptWriter.py
#    kiefer katovich 2012
#
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-


set MAINDIR = ${HOME}/cueexp

set SCRIPTSDIR = ${MAINDIR}/scripts
set DATADIR = ${MAINDIR}/data
set OUTDIR = ${DATADIR}/results_midi

if (! -d ${OUTDIR}) then
	mkdir ${OUTDIR}
endif


#-#-#-#-#-#-#-#-#-#-#-		Cycle through subjects:		-#-#-#-#-#-#-#-#-#-#-#



foreach subject ( zl150930 tm160117 )


    cd ${DATADIR}/${subject}/func_proc
    echo processing ${subject} 



#-#-#-#-#-#-#-#-#-#-#-		Run 3dDeconvolve:		-#-#-#-#-#-#-#-#-#-#-#

	3dDeconvolve -float -jobs 4 -input pp_midi_tlrc.nii -concat ${SCRIPTSDIR}/midi_runs.1D -nfirst 0 -num_stimts 21 -polort 2 -dmbase -censor midi_censor.1D \
		-stim_file 1 'midi_vr.1D[1]' -stim_label 1 'roll' \
		-stim_file 2 'midi_vr.1D[2]' -stim_label 2 'pitch' \
		-stim_file 3 'midi_vr.1D[3]' -stim_label 3 'yaw' \
		-stim_file 4 'midi_vr.1D[4]' -stim_label 4 'dS' \
		-stim_file 5 'midi_vr.1D[5]' -stim_label 5 'dL' \
		-stim_file 6 'midi_vr.1D[6]' -stim_label 6 'dP' \
		-stim_file 7 'midi_csf.1D' -stim_label 7 'csf' \
		-stim_file 8 'midi_wm.1D' -stim_label 8 'wm' \
		-stim_file 9 '../regs/ant_midic.1D' -stim_label 9 'ant' \
		-stim_file 10 '../regs/out_midic.1D' -stim_label 10 'out' \
		-stim_file 11 '../regs/target_midic.1D' -stim_label 11 'target' \
		-stim_file 12 '../regs/gvng_tar_midic.1D' -stim_label 12 'gvng_tar' \
		-stim_file 13 '../regs/gvngXwin_out_midic.1D' -stim_label 13 'gvngXwin_out' \
		-stim_file 14 '../regs/gvn_ant_midic.1D' -stim_label 14 'gvn_ant' \
		-stim_file 15 '../regs/lvn_ant_midic.1D' -stim_label 15 'lvn_ant' \
		-stim_file 16 '../regs/gvnXgvng_tar_midic.1D' -stim_label 16 'gvnXgvng_tar' \
		-stim_file 17 '../regs/lvnXgvng_tar_midic.1D' -stim_label 17 'lvnXgvng_tar' \
		-stim_file 18 '../regs/gvn_out_midic.1D' -stim_label 18 'gvn_out' \
		-stim_file 19 '../regs/nvl_out_midic.1D' -stim_label 19 'nvl_out' \
		-stim_file 20 '../regs/gvnXgvngXwin_tar_midic.1D' -stim_label 20 'gvnXgvngXwin_tar' \
		-stim_file 21 '../regs/lvnXgvngXwin_tar_midic.1D' -stim_label 21 'lvnXgvngXwin_tar' \
		-tout -fout -bucket ${subject}_glm
	

	3drefit -space tlrc -view tlrc ${subject}_glm+orig
	
#-#-#-#-#-#-#-#-#-#-#-		Write zscored dataset:		-#-#-#-#-#-#-#-#-#-#-#

	
	3dmerge -doall -1zscore -prefix ${subject}_zmidi ${subject}_glm+tlrc
	
	
#-#-#-#-#-#-#-#-#-#-#-		Remove non-zscored dataset:		-#-#-#-#-#-#-#-#-#-#-#

	#rm -rf midi_glm+tlrc*
	
#-#-#-#-#-#-#-#-#-#-#-		move results to results dir		-#-#-#-#-#-#-#-#-#-#-#
	

	mv *glm* ${OUTDIR}
	mv *zmidi* ${OUTDIR}
	
end



